{"version":3,"names":["createBrowserHistory","buildQueryString","history","originalHistoryPush","push","originalHistoryReplace","replace","preserveThemePreview","params","hasOwnProperty","currentSearch","URLSearchParams","location","search","currentThemePreview","get","wp_theme_preview","state","call","locationMemo","WeakMap","getLocationWithParams","locationWithParams","Object","fromEntries","set"],"sources":["@wordpress/router/src/history.ts"],"sourcesContent":["/**\n * External dependencies\n */\nimport { createBrowserHistory, type BrowserHistory } from 'history';\n\n/**\n * WordPress dependencies\n */\nimport { buildQueryString } from '@wordpress/url';\n\nexport interface EnhancedHistory extends BrowserHistory {\n\tgetLocationWithParams: () => Location;\n}\n\nconst history = createBrowserHistory();\n\nconst originalHistoryPush = history.push;\nconst originalHistoryReplace = history.replace;\n\n// Preserve the `wp_theme_preview` query parameter when navigating\n// around the Site Editor.\n// TODO: move this hack out of the router into Site Editor code.\nfunction preserveThemePreview( params: Record< string, any > ) {\n\tif ( params.hasOwnProperty( 'wp_theme_preview' ) ) {\n\t\treturn params;\n\t}\n\tconst currentSearch = new URLSearchParams( history.location.search );\n\tconst currentThemePreview = currentSearch.get( 'wp_theme_preview' );\n\tif ( currentThemePreview === null ) {\n\t\treturn params;\n\t}\n\treturn { ...params, wp_theme_preview: currentThemePreview };\n}\n\nfunction push( params: Record< string, any >, state: Record< string, any > ) {\n\tconst search = buildQueryString( preserveThemePreview( params ) );\n\treturn originalHistoryPush.call( history, { search }, state );\n}\n\nfunction replace(\n\tparams: Record< string, any >,\n\tstate: Record< string, any >\n) {\n\tconst search = buildQueryString( preserveThemePreview( params ) );\n\treturn originalHistoryReplace.call( history, { search }, state );\n}\n\nconst locationMemo = new WeakMap();\nfunction getLocationWithParams() {\n\tconst location = history.location;\n\tlet locationWithParams = locationMemo.get( location );\n\tif ( ! locationWithParams ) {\n\t\tlocationWithParams = {\n\t\t\t...location,\n\t\t\tparams: Object.fromEntries(\n\t\t\t\tnew URLSearchParams( location.search )\n\t\t\t),\n\t\t};\n\t\tlocationMemo.set( location, locationWithParams );\n\t}\n\treturn locationWithParams;\n}\n\nexport default {\n\t...history,\n\tpush,\n\treplace,\n\tgetLocationWithParams,\n};\n"],"mappings":";AAAA;AACA;AACA;AACA,SAASA,oBAAoB,QAA6B,SAAS;;AAEnE;AACA;AACA;AACA,SAASC,gBAAgB,QAAQ,gBAAgB;AAMjD,MAAMC,OAAO,GAAGF,oBAAoB,CAAC,CAAC;AAEtC,MAAMG,mBAAmB,GAAGD,OAAO,CAACE,IAAI;AACxC,MAAMC,sBAAsB,GAAGH,OAAO,CAACI,OAAO;;AAE9C;AACA;AACA;AACA,SAASC,oBAAoBA,CAAEC,MAA6B,EAAG;EAC9D,IAAKA,MAAM,CAACC,cAAc,CAAE,kBAAmB,CAAC,EAAG;IAClD,OAAOD,MAAM;EACd;EACA,MAAME,aAAa,GAAG,IAAIC,eAAe,CAAET,OAAO,CAACU,QAAQ,CAACC,MAAO,CAAC;EACpE,MAAMC,mBAAmB,GAAGJ,aAAa,CAACK,GAAG,CAAE,kBAAmB,CAAC;EACnE,IAAKD,mBAAmB,KAAK,IAAI,EAAG;IACnC,OAAON,MAAM;EACd;EACA,OAAO;IAAE,GAAGA,MAAM;IAAEQ,gBAAgB,EAAEF;EAAoB,CAAC;AAC5D;AAEA,SAASV,IAAIA,CAAEI,MAA6B,EAAES,KAA4B,EAAG;EAC5E,MAAMJ,MAAM,GAAGZ,gBAAgB,CAAEM,oBAAoB,CAAEC,MAAO,CAAE,CAAC;EACjE,OAAOL,mBAAmB,CAACe,IAAI,CAAEhB,OAAO,EAAE;IAAEW;EAAO,CAAC,EAAEI,KAAM,CAAC;AAC9D;AAEA,SAASX,OAAOA,CACfE,MAA6B,EAC7BS,KAA4B,EAC3B;EACD,MAAMJ,MAAM,GAAGZ,gBAAgB,CAAEM,oBAAoB,CAAEC,MAAO,CAAE,CAAC;EACjE,OAAOH,sBAAsB,CAACa,IAAI,CAAEhB,OAAO,EAAE;IAAEW;EAAO,CAAC,EAAEI,KAAM,CAAC;AACjE;AAEA,MAAME,YAAY,GAAG,IAAIC,OAAO,CAAC,CAAC;AAClC,SAASC,qBAAqBA,CAAA,EAAG;EAChC,MAAMT,QAAQ,GAAGV,OAAO,CAACU,QAAQ;EACjC,IAAIU,kBAAkB,GAAGH,YAAY,CAACJ,GAAG,CAAEH,QAAS,CAAC;EACrD,IAAK,CAAEU,kBAAkB,EAAG;IAC3BA,kBAAkB,GAAG;MACpB,GAAGV,QAAQ;MACXJ,MAAM,EAAEe,MAAM,CAACC,WAAW,CACzB,IAAIb,eAAe,CAAEC,QAAQ,CAACC,MAAO,CACtC;IACD,CAAC;IACDM,YAAY,CAACM,GAAG,CAAEb,QAAQ,EAAEU,kBAAmB,CAAC;EACjD;EACA,OAAOA,kBAAkB;AAC1B;AAEA,eAAe;EACd,GAAGpB,OAAO;EACVE,IAAI;EACJE,OAAO;EACPe;AACD,CAAC","ignoreList":[]}