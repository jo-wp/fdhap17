{"version":3,"names":["_history","require","_url","history","createBrowserHistory","originalHistoryPush","push","originalHistoryReplace","replace","preserveThemePreview","params","hasOwnProperty","currentSearch","URLSearchParams","location","search","currentThemePreview","get","wp_theme_preview","state","buildQueryString","call","locationMemo","WeakMap","getLocationWithParams","locationWithParams","Object","fromEntries","set","_default","exports","default"],"sources":["@wordpress/router/src/history.ts"],"sourcesContent":["/**\n * External dependencies\n */\nimport { createBrowserHistory, type BrowserHistory } from 'history';\n\n/**\n * WordPress dependencies\n */\nimport { buildQueryString } from '@wordpress/url';\n\nexport interface EnhancedHistory extends BrowserHistory {\n\tgetLocationWithParams: () => Location;\n}\n\nconst history = createBrowserHistory();\n\nconst originalHistoryPush = history.push;\nconst originalHistoryReplace = history.replace;\n\n// Preserve the `wp_theme_preview` query parameter when navigating\n// around the Site Editor.\n// TODO: move this hack out of the router into Site Editor code.\nfunction preserveThemePreview( params: Record< string, any > ) {\n\tif ( params.hasOwnProperty( 'wp_theme_preview' ) ) {\n\t\treturn params;\n\t}\n\tconst currentSearch = new URLSearchParams( history.location.search );\n\tconst currentThemePreview = currentSearch.get( 'wp_theme_preview' );\n\tif ( currentThemePreview === null ) {\n\t\treturn params;\n\t}\n\treturn { ...params, wp_theme_preview: currentThemePreview };\n}\n\nfunction push( params: Record< string, any >, state: Record< string, any > ) {\n\tconst search = buildQueryString( preserveThemePreview( params ) );\n\treturn originalHistoryPush.call( history, { search }, state );\n}\n\nfunction replace(\n\tparams: Record< string, any >,\n\tstate: Record< string, any >\n) {\n\tconst search = buildQueryString( preserveThemePreview( params ) );\n\treturn originalHistoryReplace.call( history, { search }, state );\n}\n\nconst locationMemo = new WeakMap();\nfunction getLocationWithParams() {\n\tconst location = history.location;\n\tlet locationWithParams = locationMemo.get( location );\n\tif ( ! locationWithParams ) {\n\t\tlocationWithParams = {\n\t\t\t...location,\n\t\t\tparams: Object.fromEntries(\n\t\t\t\tnew URLSearchParams( location.search )\n\t\t\t),\n\t\t};\n\t\tlocationMemo.set( location, locationWithParams );\n\t}\n\treturn locationWithParams;\n}\n\nexport default {\n\t...history,\n\tpush,\n\treplace,\n\tgetLocationWithParams,\n};\n"],"mappings":";;;;;;;AAGA,IAAAA,QAAA,GAAAC,OAAA;AAKA,IAAAC,IAAA,GAAAD,OAAA;AARA;AACA;AACA;;AAGA;AACA;AACA;;AAOA,MAAME,OAAO,GAAG,IAAAC,6BAAoB,EAAC,CAAC;AAEtC,MAAMC,mBAAmB,GAAGF,OAAO,CAACG,IAAI;AACxC,MAAMC,sBAAsB,GAAGJ,OAAO,CAACK,OAAO;;AAE9C;AACA;AACA;AACA,SAASC,oBAAoBA,CAAEC,MAA6B,EAAG;EAC9D,IAAKA,MAAM,CAACC,cAAc,CAAE,kBAAmB,CAAC,EAAG;IAClD,OAAOD,MAAM;EACd;EACA,MAAME,aAAa,GAAG,IAAIC,eAAe,CAAEV,OAAO,CAACW,QAAQ,CAACC,MAAO,CAAC;EACpE,MAAMC,mBAAmB,GAAGJ,aAAa,CAACK,GAAG,CAAE,kBAAmB,CAAC;EACnE,IAAKD,mBAAmB,KAAK,IAAI,EAAG;IACnC,OAAON,MAAM;EACd;EACA,OAAO;IAAE,GAAGA,MAAM;IAAEQ,gBAAgB,EAAEF;EAAoB,CAAC;AAC5D;AAEA,SAASV,IAAIA,CAAEI,MAA6B,EAAES,KAA4B,EAAG;EAC5E,MAAMJ,MAAM,GAAG,IAAAK,qBAAgB,EAAEX,oBAAoB,CAAEC,MAAO,CAAE,CAAC;EACjE,OAAOL,mBAAmB,CAACgB,IAAI,CAAElB,OAAO,EAAE;IAAEY;EAAO,CAAC,EAAEI,KAAM,CAAC;AAC9D;AAEA,SAASX,OAAOA,CACfE,MAA6B,EAC7BS,KAA4B,EAC3B;EACD,MAAMJ,MAAM,GAAG,IAAAK,qBAAgB,EAAEX,oBAAoB,CAAEC,MAAO,CAAE,CAAC;EACjE,OAAOH,sBAAsB,CAACc,IAAI,CAAElB,OAAO,EAAE;IAAEY;EAAO,CAAC,EAAEI,KAAM,CAAC;AACjE;AAEA,MAAMG,YAAY,GAAG,IAAIC,OAAO,CAAC,CAAC;AAClC,SAASC,qBAAqBA,CAAA,EAAG;EAChC,MAAMV,QAAQ,GAAGX,OAAO,CAACW,QAAQ;EACjC,IAAIW,kBAAkB,GAAGH,YAAY,CAACL,GAAG,CAAEH,QAAS,CAAC;EACrD,IAAK,CAAEW,kBAAkB,EAAG;IAC3BA,kBAAkB,GAAG;MACpB,GAAGX,QAAQ;MACXJ,MAAM,EAAEgB,MAAM,CAACC,WAAW,CACzB,IAAId,eAAe,CAAEC,QAAQ,CAACC,MAAO,CACtC;IACD,CAAC;IACDO,YAAY,CAACM,GAAG,CAAEd,QAAQ,EAAEW,kBAAmB,CAAC;EACjD;EACA,OAAOA,kBAAkB;AAC1B;AAAC,IAAAI,QAAA,GAAAC,OAAA,CAAAC,OAAA,GAEc;EACd,GAAG5B,OAAO;EACVG,IAAI;EACJE,OAAO;EACPgB;AACD,CAAC","ignoreList":[]}